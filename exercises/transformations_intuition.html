<!DOCTYPE html>
<html data-require="math math-format expressions graphie interactive">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>Transformations Intuition</title>
    <script src="../khan-exercise.js"></script>
    <style type="text/css">
        input[type=text] #xTrans #yTrans {
            width: 10px;
        }
    </style>
    <script type="text/javascript">
        var makeShape = function(){
            do{
                var points = [];
                points[0] = [KhanUtil.randRange(-10, 10), KhanUtil.randRange(-10,10)];
                var shape = KhanUtil.randFromArray(["boomerang", "blob"]);
                if(shape === "boomerang"){
                    points[1] = [points[0][0] + 2, points[0][1]];
                    points[2] = [points[0][0] + 1, points[0][1] + 1];
                    points[3] = [points[0][0], points[0][1] + 3];
                }
                else{
                    points[1] = [points[0][0] + 2, points[0][1]];
                    points[2] = [points[0][0] + 2, points[0][1] + 2];
                    points[3] = [points[0][0] + 1, points[0][1] + 3];
                }
            }
            while(!_.all(points, function(point){ return Math.abs(point[0]) <= 10 && Math.abs(point[1]) <= 10; }))
            return points;
        }

        var goalShape = function(startShape){
            do{
                // four transformations for now
                var transformations = [];
                for(var i=0; i<4; i++){
                    transformations[i] = KhanUtil.randFromArray(["t","o","e"]);
                    if(transformations[i] === "t"){
                        nextNum = KhanUtil.randRange(-5,5);
                        transformations[i] += (nextNum >= 0 ? "+" + nextNum.toString() : nextNum.toString());
                        nextNum = KhanUtil.randRange(-5,5);
                        transformations[i] += (nextNum >= 0 ? "+" + nextNum.toString() : nextNum.toString());
                    }
                    else if(transformations[i] === "o"){
                        transformations[i] += (90 * KhanUtil.randRange(1,3));
                    }
                    else{
                        transformations[i] += (KhanUtil.random() < 0.5 ? "x" : "y");
                    }
                }

                var goalPoints = [];
                for(var i=0; i<startShape.length; i++){
                    point = startShape[i];
                    for(fun in transformations){
                        if(transformations[fun][0] === "t"){
                            point = ([point[0] + Number(transformations[fun].substring(1,3)), point[1] + Number(transformations[fun].substring(3,5))]);
                        }
                        else if(transformations[fun][0] === "o"){
                            rad = Number(transformations[fun].slice(1, transformations[fun].length)) * Math.PI / 180;
                            point = ([point[0]*Math.cos(rad) - point[1]*Math.sin(rad), point[0]*Math.sin(rad) + point[1]*Math.cos(rad)]);
                        }
                        else{
                            if(transformations[fun][1] === "y"){
                                point = ([point[0]*-1, point[1]]);
                            }
                            else{
                                point = ([point[0], point[1]*-1]);
                            }
                        }
                    }
                    goalPoints.push(point);
                }
            }
            while(!_.all(goalPoints, function(point){ 
                return Math.abs(point[0]) <= 10 && Math.abs(point[1]) <= 10 
                && Math.abs(point[0] - startShape[_.indexOf(goalPoints, point)][0]) > 0.001
                && Math.abs(point[1] - startShape[_.indexOf(goalPoints, point)][1]) > 0.001; }))
            return [goalPoints, transformations];
        }

        var translatePoints = function(xDiff,yDiff){
            var x = Number(xDiff);
            var y = Number(yDiff);
            if(isNaN(x) || isNaN(y)){
                return;
            }
            else{
                cp = KhanUtil.currentGraph.graph.curPoints;
                KhanUtil.currentGraph.graph.curPoints = _.map(cp, function(point) { return [point[0] + x, point[1] + y]; });
            }
        }

        var rotatePoints = function(degrees){
            var deg = Number(degrees);
            if(isNaN(deg)){
                return;
            }
            else{
                var rad = deg * Math.PI / 180;
                cp = KhanUtil.currentGraph.graph.curPoints;
                KhanUtil.currentGraph.graph.curPoints = _.map(cp, function(point) { return [point[0]*Math.cos(rad) - point[1]*Math.sin(rad), point[0]*Math.sin(rad) + point[1]*Math.cos(rad)]; });
            }
        }

        var reflectPoints = function(axis){
            if(axis === "x"){
                _.each(KhanUtil.currentGraph.graph.curPoints, function(point) { point[1] *= -1; });
            }
            else{
                _.each(KhanUtil.currentGraph.graph.curPoints, function(point) { point[0] *= -1; });
            }
        }

        var explainTransform = function(trans){
            if(trans[0] === "t"){
                return "translate the shape by " + (trans[2] === "0" ? "" : (Number(trans.substring(1,3)) > 0 ? trans[2] : trans.substring(1,3)) + " in the x direction and ") + (trans[4] === "0" ? "" : (Number(trans.substring(3,5)) > 0 ? trans[4] : trans.substring(3,5)) + " in the y direction");
            }
            else if (trans[0] === "o"){
                return "rotate the shape by " + trans.slice(1, trans.length) + " degrees";
            }
            else{
                return "reflect the shape over the " + trans[1] + "-axis";
            }
        }

        var explainTransforms = function(translations){
            var explanation = "first ";
            for(t in translations){
                trans = translations[t];
                explanation += explainTransform(trans) + ", then ";
            }
            return explanation.slice(0, explanation.length-7) + ".";
        }
    </script>
</head>
<body>
<div class="exercise">
    <div class="problems">
        <div>
            <div class="vars">
                <var id="INIT_POINTS">makeShape()</var>
                <var id="END_POINTS, TRANSFORMS">goalShape(INIT_POINTS)</var>

                <var id="DOT_ATTRS">{ r: 0.3, fill: GRAY, stroke: "none" }</var>

            </div>

            <p class="question">Move the blue shape to the grey shape using the three kinds of transformations given.</p>

            <div class="problem">
                <form>
                    <input type="button" value="Translate" onClick="javascript:
                        translatePoints($('#xTrans').val(), $('#yTrans').val());
                        KhanUtil.currentGraph.graph.update();
                        $('#xTrans').val('');
                        $('#yTrans').val('');
                    " />
                    <label>x:</label>
                    <input type="text" id="xTrans" style="width: 15px"></input>
                    <label>y:</label>
                    <input type="text" id="yTrans" style="width: 15px"></input>
                    <input type="button" value="Rotate" onClick="javascript:
                        rotatePoints($('#degRotate').val());
                        KhanUtil.currentGraph.graph.update();
                    " />
                    <input type="text" id="degRotate" style="width: 20px"></input>
                    <label><code> {}^{\circ} </code> </label>
                    <input type="button" value="Reflect" onClick="javascript:
                        reflectPoints(KhanUtil.currentGraph.graph.reflectAxis);
                        KhanUtil.currentGraph.graph.update();
                    " />
                    <label>
                        <input name="reflectRadio" type="radio" id="xAxis" checked onClick="javascript:
                            KhanUtil.currentGraph.graph.reflectAxis = 'x';
                        " />
                        x-axis
                    </label>
                    <label>
                        <input name="reflectRadio" type="radio" id="yAxis" onClick="javascript:
                            KhanUtil.currentGraph.graph.reflectAxis = 'y';
                        " />
                        y-axis
                    </label>
                    <input type="button" value="Recover Original Location" onClick="javascript:
                        KhanUtil.currentGraph.graph.resetPoints();
                        KhanUtil.currentGraph.graph.update();
                    " />
                </form>
                </br></br>
                <div class="graphie" id="grid">
                    graphInit({
                        range: 11,
                        scale: 20,
                        axisArrows: "&lt;-&gt;",
                        tickStep: 1,
                        labelStep: 1,
                        gridOpacity: 0.05,
                        axisOpacity: 0.2,
                        tickOpacity: 0.4,
                        labelOpacity: 0.5
                    });

                    label( [ 0, 11 ], "y", "above" );
                    label( [ 11, 0 ], "x", "right" );

                    //_.each(END_POINTS, function(point) { circle(point, { r: 0.3, fill: GRAY, stroke: "none" }); });
                    for(var i = 0; i &lt; END_POINTS.length; i++){
                        line(END_POINTS[i], END_POINTS[(i+1) % 4], {stroke: GRAY, "stroke-width": 3 });
                    }

                    graph.myPoints = [];
                    graph.myLines = [];

                    for(var i = 0; i &lt; INIT_POINTS.length; i++){
                        //graph.myPoints[i] = circle(INIT_POINTS[i], { r: 0.3, fill: BLUE, stroke: "none" });
                        graph.myLines[i] = line(INIT_POINTS[i], INIT_POINTS[(i+1) % 4], { stroke: BLUE, "stroke-width": 3 });
                    }
                    
                    graph.curPoints = INIT_POINTS;
                    graph.reflectAxis = "x";

                    graph.resetPoints = function() {
                        graph.curPoints = INIT_POINTS;
                        graph.update();
                    };

                    graph.update = function() {
                        //_.each(graph.myPoints, function(point) { point.remove(); });
                        _.each(graph.myLines, function(line) { line.remove(); });
                        for(var i = 0; i &lt; INIT_POINTS.length; i++){
                            //graph.myPoints[i] = circle(graph.curPoints[i], { r: 0.3, fill: BLUE, stroke: "none" });
                            graph.myLines[i] = line(graph.curPoints[i], graph.curPoints[(i+1) % 4], { stroke: BLUE, "stroke-width": 3 });
                        }
                    };

                </div>

            </div>
            <div class="solution" data-type="custom">
                <div class="instruction">
                    Use the tranformation buttons to move the blue shape onto the grey shape.
                </div>
                <div class="guess">[ KhanUtil.currentGraph.graph.curPoints, END_POINTS ]
                </div>
                <div class="validator-function">
                    return _.all(KhanUtil.currentGraph.graph.curPoints, function(point){
                        return (Math.abs(point[0] - END_POINTS[_.indexOf(KhanUtil.currentGraph.graph.curPoints, point)][0]) &lt; 0.001)
                            &amp;&amp; (Math.abs(point[1] - END_POINTS[_.indexOf(KhanUtil.currentGraph.graph.curPoints, point)][1]) &lt; 0.001);
                    });
                </div>
                <div class="show-guess">
                    KhanUtil.currentGraph.graph.curPoints = guess[0];
                    KhanUtil.currentGraph.graph.update();
                </div>
            </div>
        </div>
    </div>

    <div class="hints">
        <p> A translation will move the blue shape that many units in the x and y direction. For example, applying a translation with <code> x=5 </code> and <code> y=-3 </code> will move the shape five units right and three units down.</p>
        <p> A rotation will rotate the shape around <code> (0,0) </code>.</p>
        <p> A reflection across an axis will move the shape to the other side of that axis, without changing anything else.</p>
        <p> One way to move the blue shape to the grey shape is to <var> explainTransforms(TRANSFORMS) </var> </p>
    </div>

</div>
</body>
</html>
