<!DOCTYPE html>
<html data-require="math math-format expressions graphie interactive">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>Transformations Intuition</title>
    <script src="../khan-exercise.js"></script>
    <style type="text/css">
        input[type=text] #xTrans #yTrans {
            width: 10px;
        }
    </style>
    <script type="text/javascript">
        var makeShape = function(){
            do{
                var points = [];
                points[0] = [KhanUtil.randRange(-10, 10), KhanUtil.randRange(-10,10)];
                var shape = KhanUtil.randFromArray(["boomerang", "blob"]);
                if(shape === "boomerang"){
                    points[1] = [points[0][0] + 2, points[0][1]];
                    points[2] = [points[0][0] + 1, points[0][1] + 1];
                    points[3] = [points[0][0], points[0][1] + 3];
                }
                else{
                    points[1] = [points[0][0] + 2, points[0][1]];
                    points[2] = [points[0][0] + 2, points[0][1] + 2];
                    points[3] = [points[0][0] + 1, points[0][1] + 3];
                }
            }
            while(!_.all(points, function(point){ return Math.abs(point[0]) <= 10 && Math.abs(point[1]) <= 10; }))
            return points;
        }

        var goalShape = function(startShape){
            // four transformations for now
            var transformations = [];
            for(var i=0; i<4; i++){
                transformations[i] = KhanUtil.randFromArray(["t","o","e"]);
                if(transformations[i] === "t"){
                    nextNum = KhanUtil.randRange(-5,5);
                    transformations[i] += (nextNum >= 0 ? "+" + nextNum.toString() : nextNum.toString());
                    nextNum = KhanUtil.randRange(-5,5);
                    transformations[i] += (nextNum >= 0 ? "+" + nextNum.toString() : nextNum.toString());
                }
                else if(transformations[i] === "o"){
                    transformations[i] += (90 * KhanUtil.randRange(1,3));
                }
                else{
                    transformations[i] += (KhanUtil.random() < 0.5 ? "x" : "y");
                }
            }

            console.log(transformations);
            console.log(startShape);
            var goalPoints = [];
            for(var i=0; i<startShape.length; i++){
                point = startShape[i];
                for(fun in transformations){
                    if(transformations[fun][0] === "t"){
                        point = ([point[0] + Number(transformations[fun].substring(1,3)), point[1] + Number(transformations[fun].substring(3,5))]);
                    }
                    else if(transformations[fun][0] === "o"){
                        rad = Number(transformations[fun].slice(1, transformations[fun].length)) * Math.PI / 180;
                        point = ([point[0]*Math.cos(rad) - point[1]*Math.sin(rad), point[0]*Math.sin(rad) + point[1]*Math.cos(rad)]);
                    }
                    else{
                        if(transformations[fun][1] === "y"){
                            point = ([point[0]*-1, point[1]]);
                        }
                        else{
                            point = ([point[0], point[1]*-1]);
                        }
                    }
                }
                goalPoints.push(point);
            }

            // goalPoints =  _.map(startShape, function(point){ 
            //     for(fun in transformations){
            //         console.log(point);
            //         if(transformations[fun][0] === "t"){
            //             return [point[0] + Number(transformations[fun][1]), point[1] + Number(transformations[fun][2])];
            //         }
            //         else if(transformations[fun][0] === "o"){
            //             rad = Number(transformations[fun].slice(1, transformations[fun].length));
            //             return [point[0]*Math.cos(rad) - point[1]*Math.sin(rad), point[0]*Math.sin(rad) + point[1]*Math.cos(rad)];
            //         }
            //         else{
            //             if(transformations[fun][1] === "y"){
            //                 return [point[0]*-1, point[1]];
            //             }
            //             else{
            //                 return [point[0], point[1]*-1];
            //             }
            //         }
            //     }
            // });
            return goalPoints;
        }

        var translatePoints = function(xDiff,yDiff){
            var x = Number(xDiff);
            var y = Number(yDiff);
            if(isNaN(x) || isNaN(y)){
                return;
            }
            else{
                cp = KhanUtil.currentGraph.graph.curPoints;
                KhanUtil.currentGraph.graph.curPoints = _.map(cp, function(point) { return [point[0] + x, point[1] + y]; });
            }
        }

        var rotatePoints = function(degrees){
            var deg = Number(degrees);
            if(isNaN(deg)){
                return;
            }
            else{
                var rad = deg * Math.PI / 180;
                cp = KhanUtil.currentGraph.graph.curPoints;
                KhanUtil.currentGraph.graph.curPoints = _.map(cp, function(point) { return [point[0]*Math.cos(rad) - point[1]*Math.sin(rad), point[0]*Math.sin(rad) + point[1]*Math.cos(rad)]; });
            }
        }

        var reflectPoints = function(axis){
            if(axis === "x"){
                _.each(KhanUtil.currentGraph.graph.curPoints, function(point) { point[1] *= -1; });
            }
            else{
                _.each(KhanUtil.currentGraph.graph.curPoints, function(point) { point[0] *= -1; });
            }
        }
    </script>
</head>
<body>
<div class="exercise">
    <div class="problems">
        <div>
            <div class="vars">
                <var id="INIT_POINTS">makeShape()</var>
                <var id="END_POINTS">goalShape(INIT_POINTS)</var>

                <var id="DOT_ATTRS">{ r: 0.3, fill: GRAY, stroke: "none" }</var>

            </div>

            <p class="question">Move the blue shape to the grey shape using the three kinds of transformations given.</p>

            <div class="problem">
                <form>
                    <input type="button" value="Translate" onClick="javascript:
                        translatePoints($('#xTrans').val(), $('#yTrans').val());
                        KhanUtil.currentGraph.graph.update();
                    " />
                    <label>x:</label>
                    <input type="text" id="xTrans" style="width: 15px"></input>
                    <label>y:</label>
                    <input type="text" id="yTrans" style="width: 15px"></input>
                    <input type="button" value="Rotate" onClick="javascript:
                        rotatePoints($('#degRotate').val());
                        KhanUtil.currentGraph.graph.update();
                    " />
                    <input type="text" id="degRotate" style="width: 20px"></input>
                    <label><code> {}^{\circ} </code> </label>
                    <input type="button" value="Reflect" onClick="javascript:
                        reflectPoints(KhanUtil.currentGraph.graph.reflectAxis);
                        KhanUtil.currentGraph.graph.update();
                    " />
                    <label>
                        <input name="reflectRadio" type="radio" id="xAxis" checked onClick="javascript:
                            KhanUtil.currentGraph.graph.reflectAxis = 'x';
                        " />
                        x-axis
                    </label>
                    <label>
                        <input name="reflectRadio" type="radio" id="yAxis" onClick="javascript:
                            KhanUtil.currentGraph.graph.reflectAxis = 'y';
                        " />
                        y-axis
                    </label>
                    <input type="button" value="Recover Original Location" onClick="javascript:
                        KhanUtil.currentGraph.graph.resetPoints();
                        KhanUtil.currentGraph.graph.update();
                    " />
                </form>
                </br></br>
                <div class="graphie" id="grid">
                    graphInit({
                        range: 11,
                        scale: 20,
                        axisArrows: "&lt;-&gt;",
                        tickStep: 1,
                        labelStep: 1,
                        gridOpacity: 0.05,
                        axisOpacity: 0.2,
                        tickOpacity: 0.4,
                        labelOpacity: 0.5
                    });

                    label( [ 0, 11 ], "y", "above" );
                    label( [ 11, 0 ], "x", "right" );

                    _.each(END_POINTS, function(point) { circle(point, { r: 0.3, fill: GRAY, stroke: "none" }); });
                    for(var i = 0; i &lt; END_POINTS.length; i++){
                        line(END_POINTS[i], END_POINTS[(i+1) % 4]);
                    }

                    graph.myPoints = [];
                    graph.myLines = [];

                    for(var i = 0; i &lt; INIT_POINTS.length; i++){
                        graph.myPoints[i] = circle(INIT_POINTS[i], { r: 0.3, fill: BLUE, stroke: "none" });
                        graph.myLines[i] = line(INIT_POINTS[i], INIT_POINTS[(i+1) % 4]);
                    }
                    
                    graph.curPoints = INIT_POINTS;
                    graph.reflectAxis = "x";

                    graph.resetPoints = function() {
                        graph.curPoints = INIT_POINTS;
                        graph.update();
                    };

                    graph.update = function() {
                        _.each(graph.myPoints, function(point) { point.remove(); });
                        _.each(graph.myLines, function(line) { line.remove(); });
                        for(var i = 0; i &lt; INIT_POINTS.length; i++){
                            graph.myPoints[i] = circle(graph.curPoints[i], { r: 0.3, fill: BLUE, stroke: "none" });
                            graph.myLines[i] = line(graph.curPoints[i], graph.curPoints[(i+1) % 4]);
                        }
                    };

                </div>

            </div>
            <div class="solution" data-type="custom">
                <div class="instruction">
                    Drag the two points to move the line into the correct position.
                </div>
                <div class="guess">[ graph.pointA.coord, graph.pointB.coord,
                    graph.pointA.coord[0] &gt; graph.pointB.coord[0] ? graph.shadetop : !graph.shadetop,
                    graph.dasharray === "- " ? false : true ]
                </div>
                <div class="validator-function">
                    var slope = ( guess[1][1] - guess[0][1] ) / ( guess[1][0] - guess[0][0] );
                    var yint = slope * ( 0 - guess[0][0] ) + guess[0][1];
                    return abs( SLOPE - slope ) &lt; 0.001
                        &amp;&amp; abs( YINT - yint ) &lt; 0.001
                        &amp;&amp; guess[2] === LESS_THAN
                        &amp;&amp; guess[3] === INCLUSIVE;
                </div>
                <div class="show-guess">
                    graph.pointA.setCoord( guess[0] );
                    graph.pointB.setCoord( guess[1] );
                    graph.shadetop = graph.pointA.coord[0] &gt; graph.pointB.coord[0] ? guess[2] : !guess[2];
                    if ( guess[3] ) {
                        graph.dasharray = "";
                        $( "input[name=dashradio][value=solid]" ).attr( "checked", true );
                    } else {
                        graph.dasharray = "- ";
                        $( "input[name=dashradio][value=dashed]" ).attr( "checked", true );
                    }
                    graph.update();
                </div>
                <div class="example">graph the inequality</div>
                <div class="example">make sure the correct side is shaded</div>
                <div class="example">make sure the line is correctly shown as solid or dashed</div>
            </div>
        </div>
    </div>

    <div class="hints">
        
    </div>

</div>
</body>
</html>
