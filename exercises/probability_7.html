<!DOCTYPE html>
<html data-require="math math-format probability probability-grid word-problems">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>Probability 7</title>
    <style>
    .probaGrid input {
        width:30px;
    }
    .probaGrid td {
        text-align: center;
        vertical-align: middle;
        width: 120px;
        height: 60px;
    }
    .probaGrid .in {
        border: solid black 3px;
    }
    .smallGrid {
        width:135px;
    }
    .smallGrid td {
        width: 45px;
        height: 30px;
        text-align: center;
        vertical-align: middle;
    }
    .smallGrid .in {
        border: solid black 2px;
    }
    .bullet li {
        list-style:disc;
        margin-left:20px;        
    }
    </style>
    <script src="../khan-exercise.js"></script>
    <script>
    var genGridProblem = function() {
        var itemKind = KhanUtil.getRandomItemKind();
        var selectedItems = KhanUtil.probaGrid.select2ItemsPerType(itemKind);
        var solver = new KhanUtil.getConstraintSolver();
        var naming = KhanUtil.probaGrid.getNaming(itemKind, selectedItems);
        var solution = KhanUtil.probaGrid.genSolution(naming);
        var listVariables = KhanUtil.probaGrid.initSolver(solver, itemKind, naming, solution);
        var setVariables = KhanUtil.probaGrid.fillKnownVariables(solver, listVariables, naming);
        var hints = solver.getHints(naming);
        hints.push("<p>So finally, we get everything filled:<br/>" + solver.getHintTable(undefined, undefined, 100000, naming) + "</p>");
        var question = "<p>The grid represented above has two rows and two columns, where each row represents a different " + 
                itemKind.criteriaNames[1] + ", and each column represents " + KhanUtil.an(itemKind.criteriaNames[0]) + ".</p>" +
                "<p>" + naming.questionPart2 + "</p>";


        return {
            statement: "A " + itemKind.container + " contains " + itemKind.pluralName + " that can be described by their " +
                itemKind.criteriaNames[0] + " and their " + itemKind.criteriaNames[1] + ". Each " + itemKind.name + " is either " +
                naming.termsSingular[0][0] + " or " + naming.termsSingular[0][1] + ", and each " +
                itemKind.name + " is  either " + naming.termsSingular[1][0] + " or " +
                naming.termsSingular[1][1] + ".</p><p>" + naming.introFacts + ":</p>",
            hints: hints,
            table: KhanUtil.probaGrid.getTable(itemKind, naming),
            question: question,
            facts: KhanUtil.probaGrid.getListFacts(setVariables, naming),
            solution: solution,
            answer: getAnswer(solution)
        };
    };

    var getAnswer = function(solution) {
        var listSols = [];
        var nbRows = solution.length;
        for (var iRow = 0; iRow < nbRows; iRow++) {
            listSols = listSols.concat(solution[iRow]);
        }
        return listSols.join(",");
    };

    var getGuess = function(solution) {
        var nbRows = solution.length;
        var nbCols = solution[0].length;
        var sols = [];
        for (var iRow = 0; iRow < nbRows; iRow++) {
            for (var iCol = 0; iCol < nbCols; iCol++) {
                var val = $("#" + iRow + "-" + iCol).val();
                if (val === undefined) {
                    val = "100";
                }
                if (val === "") {
                    return 0;
                }
                sols.push(val);                
            }
        }
        return sols.join(",");
    };
    </script>
</head>
<body>
    <div class="exercise">
    <div class="problems">
        <div>
            <div class="vars">
                <var id="PROBLEM">genGridProblem()</var>
            </div>

            <div class="question">
                <var>PROBLEM.statement</var>
                <p><ul class='bullet'>
                    <var>PROBLEM.facts</var>
                </ul>
                </p>
                <p><var>PROBLEM.table</var></p>
                <var>PROBLEM.question</var>
            </div>

				<div class="solution" data-type="custom">
					<div class="instruction">
						Fill all the input areas
					</div>
					<div class="guess">getGuess(PROBLEM.solution)</div>
					<div class="validator-function">
						if ( guess === 0 ) {
							return "";
						}
						return guess === PROBLEM.answer;
					</div>
				</div>

    		<div class="hints">
	    		<div data-each="PROBLEM.hints as key, value"><var>value</var></div>
	    	</div>
        </div>
    </div>
    </div>
</body>
</html>

