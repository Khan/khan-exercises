<!DOCTYPE html>
<html data-require="math math-format graphie graphie-helpers word-problems">
<head>
	<meta charset="UTF-8" />
	<title>Fractions slice and clone 1</title>
	<script src="../khan-exercise.js"></script>
	<script>
	var d, n_parent, n_offspring;
	var pieces = 1;
	var times = 1;

	function passVars( d_arg, n_parent_arg, n_offspring_arg ) {
		d = d_arg;
		n_parent = n_parent_arg;
		n_offspring = n_offspring_arg;
	}


	function changePieces( increase ) {
		if ( pieces === 1 && !increase ) {
			return;
		}

		pieces += ( increase ) ? 1 : -1;

		jQuery( "#pieces" ).text( KhanUtil.plural(pieces, "piece") ); 

		KhanUtil.currentGraph = jQuery( "#problemarea" ).find( "#parent_block" ).data( "graphie" );

		rectchart( [ 1, pieces - 1 ], ["#e00", "#999" ] );
	}

	function slice() {
		jQuery( "#slice_pieces" ).html( "<code>" + pieces + "</code>" ).tmpl();
		jQuery( ".slice_fraction" ).each(function( i, elem) {
			var code = jQuery( "<code>" + KhanUtil.fractionReduce(n_parent + d, d * pieces) + "</code>");
			jQuery( elem ).html( code ).tmpl();
		});
		jQuery( "#slice_equation" ).show();

		if ( pieces !== n_parent + d ) {
			jQuery( "#slice_alert" ).text( "Wrong!" );
			jQuery( "#slice_explanation" ).show();
			return;
		} else {
			jQuery( "#slice_explanation" ).hide();
		}

		jQuery( "#slice_alert" ).text( "Correct!" );
		jQuery( "#slice_controls" ).hide();
		jQuery( "#cloning" ).show();
	}

	function changeTimes( increase ) {
		if ( times === 1 && !increase || times === pieces && increase) {
			return;
		}

		times += ( increase ) ? 1 : -1;

		jQuery( "#times" ).text( KhanUtil.plural(times, "time") );

		var graph = KhanUtil.currentGraph = jQuery( "#problemarea" ).find( "#offspring_block" ).data( "graphie" );

		graph.init({ range: [ [ 0, 1 ], [ 0, 1 ] ],scale: [ 600 / (d + n_parent) * times, 25 ] });
		rectchart( [ times, 0 ], ["#e00", "#999" ] );
	}

	function clone() {
		jQuery( "#clone_times" ).html( "<code>" + times + "</code>" ).tmpl();
		jQuery( ".clone_fraction" ).each(function( i, elem) {
			var code = jQuery( "<code>" + KhanUtil.fractionReduce( ( n_parent + d ) * times, d * pieces ) + "</code>");
			jQuery( elem ).html( code ).tmpl();
		});
		jQuery( "#clone_equation" ).show();

		if ( times !== n_offspring ) {
			jQuery( "#clone_alert" ).text( "Wrong!" );
			jQuery( "#clone_explanation" ).show();
			return;
		} else {
			jQuery( "#clone_explanation" ).hide();
		}

		rectchart( [ 1, 0 ], [ "#e00", "#999" ] );
		jQuery( "#clone_alert" ).text( "Correct!" );
	}
	</script>
</head>
<body>
	<div class="exercise">
		<div class="vars">
			<var id="D">randRange( 3, 8 )</var>
			<div data-ensure="getGCD( D + N_PARENT, N_OFFSPRING ) === 1">
				<var id="N_PARENT">randRange( 2, D - 1 )</var>
				<var id="N_OFFSPRING">randRange( 2, D - 1 )</var> 
			</div>
			<var id="FRACTION_PARENT">fraction( N_PARENT, D )</var>
			<var id="FRACTION_OFFSPRING">fraction( N_OFFSPRING, D )</var>
		</div>

		<div class="problems">
			<div>
				<div class="problem">
					<p>This block is <code>1 <var>FRACTION_PARENT</var></code> units long.</p>
					<div class="graphie" id="parent_block">
						init({ range: [ [ 0, 1 ], [ 0, 1 ] ],scale: [ 600, 25 ] });

						passVars( D, N_PARENT, N_OFFSPRING );

						rectchart( [ 1, 0 ], ["#e00", "#999" ] );
					</div>
					<p>You need a new block that is <code><var>FRACTION_OFFSPRING</var></code> units long.</p>

					<div id="slice_controls">
						<p>Slice the block into any number of pieces to create a base unit that can be cloned to create the new block.</p>
						<input type="button" value="<" id="decrease_pieces" onclick="changePieces( false )">
						<span id="pieces">1 piece</span>
						<input type="button" value=">" id="increase_pieces" onclick="changePieces( true )">
						<input type="button" value="Slice" onclick="slice()">
					</div>
					
					<p id="slice_alert"></p>
					<p id="slice_equation" style="display: none;"><code>1 <var>FRACTION_PARENT</var> รท </code><span id="slice_pieces"></span> = </code><span class="slice_fraction"></span></p>
					<div id="slice_explanation" style="display: none;">
						<p>You cannot make a block that is <code><var>FRACTION_OFFSPRING</var></code> units long by cloning pieces that are <span class="slice_fraction"></span> units long! Try again.</p>
					</div>

					<div id="cloning" style="display: none;">
						<div class="graphie" id="offspring_block">
							init({ range: [ [ 0, 1 ], [ 0, 1 ] ],scale: [ 600 / (D + N_PARENT), 25 ] });

							rectchart( [ 1, 0 ], ["#e00", "#999" ] );
						</div>
						<p>Clone the new block to create a block that is <code><var>FRACTION_OFFSPRING</var></code> units long.</p>
					<input type="button" value="<" id="decrease_clones" onclick="changeTimes( false )">
					<span id="times">1 time</span>
					<input type="button" value=">" id="increase_clones" onclick="changeTimes( true )">
					<input type="button" value="Clone" onclick="clone()"> 
					<p id="clone_alert"></p>
					<p id="clone_equation" style="display: none;"><span class="slice_fraction"></span> ร <span id="clone_times"></span> = <span class="clone_fraction"></span></code></p>
				</div>

				<div class="solution">
					5
				</div>
			</div>
		</div>
	</div>
</body>
</html>
