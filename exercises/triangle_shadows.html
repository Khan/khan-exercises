<!DOCTYPE html>
<html data-require="math graphie graphie-helpers-arithmetic word-problems meatglue">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<title>Triangle Shadows</title>
	<script src="../khan-exercise.js"></script>
	<style type="text/css" media="screen">
		#sidesAvailable span{
			margin-right:1em;
		}
		[data-section]{ display:none; }
		
		.invalid input, .invalid textarea { background-color: #f0dddd; }

		.lfrac, .rfrac, .mfrac{ display:table-cell; vertical-align:middle; padding:5px; }
		.lfrac span, .rfrac span{display:block; margin:6px; }
		.lfrac hr, .rfrac hr { border-top: 2px solid #666; margin:3px; height:0; width:90%; }

		.fake_row span, .fake_header span{
			width:30%;
		}
		/*meatglue styles*/
		[data-type=editable], [data-type=slidable]{
		  border-bottom: 1px dotted #369;
		}
		[data-type=editable] input{
		  width:75px;
		  border-width:0;
		  border-bottom:1px solid #369;
		}
		.sliding, [data-type=slidable]{
		  cursor: EW-resize;
		}
		[data-type=draggable], [data-type=droppable]{
		  background-color:rgb(207, 232, 236);
		  color:rgb(93, 146, 163);
		  padding: 3px 6px;
		  font-style:normal;
		  font-weight:bold;
		  cursor:move;
		  -webkit-border-radius: 4px;
		  -webkit-box-shadow:-2px 2px 1px #aaa;
		  -moz-border-radius: 4px;
		  -moz-box-shadow:-2px 2px 1px #aaa;
		  -o-border-radius: 4px;
		  -o-box-shadow:-2px 2px 1px #aaa;
		  border-radius: 4px;
		  box-shadow:-2px 2px 1px #aaa;
		  margin-right:3px;
		}
		[data-type=droppable]{
		  color:transparent;
		  border:2px dotted rgb(93, 146, 163);
		  background-color: rgb(235,245,255);
		  display:inline-block;
		  -webkit-box-shadow:0px 0px 1px #aaa;
		  -moz-box-shadow:0px 0px 1px #aaa;
		  -o-box-shadow:0px 0px 1px #aaa;
		  box-shadow:0px 0px 1px #aaa;
		}
	</style>
</head>
<body>
	<div class="exercise">
	<script type="text/meatglue">
		defaults = {foo : 23};

		init = function(){
			// TODO please save these on actual init, not here
			this.set("exercise_vars", KhanUtil.tmpl.getVARS() );
			this.reveal("intro")
		}

		update = function(){
			var that = this;
			var ev = this.get("exercise_vars");
			this.set("bar", this.get("foo") * 4);
			var sides = this.get("pickThree");
			if(sides.length >= 2){
				this.reveal("ratio");
			}

			if(sides.length === 3){
				// clear out the table and populate it
				$(".tablevals .fake_row").remove();
				for(var i=0; i<sides.length; i+=1){
					var varName = sides[i];
					var varVal = KhanUtil.roundTo(3, ev[varName]);
					var row = $("<div>",{class:"fake_row reading"})
						.append($("<span>").text(varName))
						.append($("<span>").text(varVal))
						.appendTo($(".tablevals"))
				}
			}
			var walker = function(elt){ 
				var v = $(elt).data("name")
				return that.get( v )
			}
			var fraction = _($("#targets [data-type='droppable']"));
			var dv = fraction.map(walker)

			// dealing with fractions
			var lr = KhanUtil.roundTo(4, ev[this.get("lnum")] / ev[this.get("ldenom")])
			var rr = KhanUtil.roundTo(4, ev[this.get("rnum")] / ev[this.get("rdenom")])

			// check if four items were picked (probably not necessary since this is a weird ui)
			if(_.uniq(dv).length === 4){
				// check if ratio on left matches ratio on right
				this.set( "ratio_eq", (lr === rr) )
				var ratdiff = _([lr, rr]).map(function(elt){ return _.isNaN(elt) ? 0 : elt; });
				ratdiff = ratdiff[0] - ratdiff[1];
				if (ratdiff < 0){
					$(".mfrac").text("<")
				}else if (ratdiff > 0){
					$(".mfrac").text(">")
				}else{
					$(".mfrac").text("=")
					var correct = true;
				}

			}

			if(this.get("ratio_eq")){
				var pos = fraction.filter( function(elt){ 
					var n = $(elt).data("name");
					return that.get(n) === "x"
				})

				var opposite = ev[ this.get($(pos[0]).data("opposite")) ]

				var inNumerator = this.get("lnum") === "x" || this.get("rnum") === "x";
				var x = KhanUtil.roundTo(3, ev["x"]);
				if( inNumerator ){
					// multiply by opposite
					var correct = KhanUtil.roundTo(3, lr * opposite) === x || 
						KhanUtil.roundTo(3, rr * opposite) === x
				}else{
					// divide by opposite
					var correct = KhanUtil.roundTo(3, opposite / lr) === x || 
						KhanUtil.roundTo(3, opposite / rr) === x
				}
			}
			if( correct ){
				$(".mfrac").text("=");
				this.reveal("fill-in");
			}
		}

		createButtons = function(){
			var sides = this.get("pickThree");
			if( sides.length <=3 ){
				this.createVars(sides, "draggable", "#draggablehome");
			}
		}

	</script>
	
	<div class="vars">
		<var id="d">randRange( 1, 10 )</var>
		<var id="c">randRange( 1, 10 )</var>
		<var id="e">randRange( 2, 4 )</var>
		<var id="a">Math.sqrt( d*d + c*c )</var>
		<var id="de">d + e</var>		
		<var id="x">( de * c ) / d</var>
		<var id="b">Math.sqrt( e*e + (x-c)*(x-c)) </var>
		<var id="ab">a + b</var>
	</div>

	<div class="problems">
		<div>
			<div class="question meatglue">
				<p><var>"&lt;img src='" + Khan.urlBase + "images/treeshadow.jpg'&gt;"</var></p>

				<div data-section="intro">
					<div class="col1 forty-sixty">
						<p>Alex is standing so that <var>his(1)</var> shadow, <code>d</code> feet long, is perfectly matched to the top of the tree's shadow (which is <code>d + e</code> feet long).</p>
						<p>Alex is lucky and has a friend measure all the distances listed (and two others, <code>ab = a + b</code> and <code>de = d + e</code>).</p>
					</div>
					<div class="col2 forty-sixty">
						<p>Which three of the following variables are needed to find x?</p>
						<p><span id="sidesAvailable" data-name="pickThree" data-onchange="createButtons" data-type="selectable" data-options="a,b,c,d,e,ab,de" data-max="3"></span>
					</div>
				</div>

				<div style="clear:both;"></div>

				<div data-section="ratio">
					
					<div class="col1 forty-sixty">
						<p>Drag the <code>x</code> and the other variables you selected to the right to set up the ratio you think is right.</p>
						<p><span data-name="x"data-type="draggable"></span><span id="draggablehome"></span>
					</div>
					<div class="col2 forty-sixty">
						<div id="targets">
							<div class="lfrac">
								<span data-name="lnum" data-type="droppable" data-opposite="ldenom"></span>
								<hr>
								<span data-name="ldenom" data-type="droppable" data-opposite="lnum"></span>
							</div>
							<div class="mfrac">?=</div>
							<div class="rfrac">
								<span data-name="rnum" data-type="droppable" data-opposite="rdenom"></span>
								<hr>
								<span data-name="rdenom" data-type="droppable" data-opposite="rnum"></span>
							</div>
						</div>
					</div>
					
				</div>

				<div style="clear:both;"></div>
				<div data-section="fill-in">
					<div class="col1 forty-sixty">
						Here's a table with the values, in feet, for each distance you picked:
						<div class="tablevals">
							<div class="fake_header reading">
								<span>Variable</span>
								<span>Value</span>
							</div>
						</div>
					</div>
					<div class="col2 forty-sixty">
						Using these values, and the ratio you set up above, what is x?
					</div>
				</div>
			</div>
			<div class="solution" data-type="rational"> <var>( de * c ) / d</var> </div>
			<div class="hints">
			</div>

		</div>
	</div>
	</div>
</body>
</html>
